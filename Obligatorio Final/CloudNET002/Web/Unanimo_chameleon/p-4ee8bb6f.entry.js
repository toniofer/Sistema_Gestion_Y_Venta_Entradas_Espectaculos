import{r as t,h as e,H as s}from"./p-23c5f09f.js";var i;function n(t){t.ParentObject.refreshGrid(t.ControlName)}!function(t){t.FIRST="first",t.PREVIOUS="previous",t.NEXT="next",t.LAST="last"}(i||(i={}));class r{static load(t,e){var s;this.grid=t,this.state=null!=e?e:{},this.state.Columns=null!==(s=this.state.Columns)&&void 0!==s?s:[],this.apply()}static setColumnSort(t,e){this.state.SortColumnName=t,this.state.SortDirection=e}static setColumnHidden(t,e){this.getColumn(t).Hidden=e}static setColumnSize(t,e){this.getColumn(t).Size=e}static setColumnOrder(t,e){this.getColumn(t).Order=e}static setColumnFilterEqual(t,e){this.getColumnFilter(t).Equal=e}static setColumnFilterLess(t,e){this.getColumnFilter(t).Less=e}static setColumnFilterGreater(t,e){this.getColumnFilter(t).Greater=e}static apply(){var t,e;let s=this.grid.getColumnByHtmlName((null!==(t=this.state.SortColumnName)&&void 0!==t?t:"").toUpperCase());s&&(s.SortDirection=this.state.SortDirection),null===(e=this.state.Columns)||void 0===e||e.forEach(t=>{var e,s,i,n,r,a;let h=this.grid.getColumnByHtmlName(t.Name.toUpperCase());h&&(h.Hidden=t.Hidden?-1:0,h.filterEqual=null!==(s=(null!==(e=t.Filter)&&void 0!==e?e:{}).Equal)&&void 0!==s?s:h.filterEqual,h.filterLess=null!==(n=(null!==(i=t.Filter)&&void 0!==i?i:{}).Less)&&void 0!==n?n:h.filterLess,h.filterGreater=null!==(a=(null!==(r=t.Filter)&&void 0!==r?r:{}).Greater)&&void 0!==a?a:h.filterGreater)})}static getColumn(t){let e=this.state.Columns.find(e=>0==e.Name.localeCompare(t));return e||(e={Name:t},this.state.Columns.push(e)),e}static getColumnFilter(t){let e=this.getColumn(t);return e.Filter||(e.Filter={}),e.Filter}}const a=class{constructor(e){t(this,e)}selectionChangedHandler(t){const e=this.getRowIndexByGxId(t.detail.rowsId[0]);e>=0&&(this.grid.execC2VFunctions(),this.grid.selectRow(e))}cellClickedHandler(t){const e=this.getRowIndexByGxId(t.detail.rowId),s=parseInt(t.detail.cellId);e>=0&&this.grid.executeEvent(s,e)}navigationClickedHandler(t){switch(t.detail.navigationType){case i.FIRST:(e=this.grid).OnPaginationFirst?e.OnPaginationFirst():e.usePaging&&e.changeGridPage("FIRST");break;case i.PREVIOUS:!function(t){t.OnPaginationPrevious?t.OnPaginationPrevious():t.usePaging&&t.changeGridPage("PREV")}(this.grid);break;case i.NEXT:!function(t){t.OnPaginationNext?t.OnPaginationNext():t.usePaging&&t.changeGridPage("NEXT")}(this.grid);break;case i.LAST:!function(t){t.OnPaginationLast?t.OnPaginationLast():t.usePaging&&t.changeGridPage("LAST")}(this.grid)}var e}refreshClickedHandler(){n(this.grid)}columnHiddenChangedHandler(t){r.setColumnHidden(t.detail.columnId,t.detail.hidden)}columnSizeChangedHandler(t){r.setColumnSize(t.detail.columnId,t.detail.size)}columnSortChangedHandler(t){switch(r.setColumnSort(t.detail.columnId,t.detail.sortDirection),this.grid.SortMode){case"client":!function(t,e,s){const i=t.getColumnByHtmlName(e);t.setSort(i.index,"desc"!=s)}(this.grid,t.detail.columnId,t.detail.sortDirection),this.gridTimestamp=Date.now();break;case"server":n(this.grid)}}columnOrderChangedHandler(t){r.setColumnOrder(t.detail.columnId,t.detail.order)}controlStateHandler(){this.loadState()}handleChangeFilterEqual(t){const e=t.target;this.grid.getColumnByHtmlName(e.dataset.columnId).filterEqual=e.value,r.setColumnFilterEqual(e.dataset.columnId,e.value),n(this.grid)}handleChangeFilterLess(t){const e=t.target;this.grid.getColumnByHtmlName(e.dataset.columnId).filterLess=e.value,r.setColumnFilterLess(e.dataset.columnId,e.value),n(this.grid)}handleChangeFilterGreater(t){const e=t.target;this.grid.getColumnByHtmlName(e.dataset.columnId).filterGreater=e.value,r.setColumnFilterGreater(e.dataset.columnId,e.value),n(this.grid)}componentWillLoad(){this.loadState()}componentWillRender(){this.defineColumnRender()}componentDidLoad(){this.setCurrentRow(),this.notifyResizePopup()}render(){return e(s,null,e("ch-grid",{class:this.grid.Class,rowSelectionMode:this.grid.gxAllowSelection?"single":"none",onRowSelectedClass:this.grid.RowSelectedClass.trim(),onRowHighlightedClass:this.grid.RowHighlightedClass.trim()},this.grid.header&&this.renderTitle(),this.renderActionbar("header",this.grid.ActionbarHeaderClass),this.renderActionbar("footer",this.grid.ActionbarFooterClass),this.renderColumns(),this.renderRows(),this.grid.PaginatorShow&&this.grid.pageSize>0&&this.renderPaginator()))}renderTitle(){return e("h1",{slot:"header"},this.grid.header)}renderActionbar(t,s){const i=this.grid.ActionRefreshPosition==t,n=this.grid.ActionSettingsPosition==t;if(i||n)return e("ch-grid-actionbar",{slot:t,class:s},i&&this.renderActionRefresh(),n&&this.renderActionSettings())}renderActionRefresh(){return e("ch-grid-action-refresh",{class:this.grid.ActionRefreshClass,title:"title"==this.grid.ActionRefreshTextPosition?gx.getMessage("GX_BtnRefresh"):""},"text"==this.grid.ActionRefreshTextPosition?gx.getMessage("GX_BtnRefresh"):"")}renderActionSettings(){return e("ch-grid-action-settings",{class:this.grid.ActionSettingsClass,title:"title"==this.grid.ActionSettingsTextPosition?gx.getMessage("GXM_Settings"):""},"text"==this.grid.ActionSettingsTextPosition?gx.getMessage("GXM_Settings"):"")}renderColumns(){return e("ch-grid-columnset",{class:this.grid.ColumnsetClass},this.grid.columns.map(t=>{if(gx.lang.gxBoolean(t.render))return e("ch-grid-column",{columnId:t.htmlName,columnIconUrl:t.Icon,columnName:t.title,columnNamePosition:t.NamePosition,size:this.getColumnSize(t),displayObserverClass:t.gxColumnClass,class:`${this.grid.ColumnClass} ${t.HeaderClass}`,hidden:-1==t.Hidden,hideable:-1==t.Hideable,resizeable:-1==t.Resizeable,sortable:-1==t.Sortable,settingable:-1==t.Filterable,sortDirection:t.SortDirection},-1==t.Filterable&&this.renderColumnFilter(t))}))}renderColumnFilter(t){return e("div",{slot:"settings"},e("fieldset",null,e("caption",null,"Filter"),"single"==t.FilterMode&&this.renderColumnFilterControl(t.htmlName,t.gxControl.type,t.gxControl.dataType,t.filterEqual,this.handleChangeFilterEqual),"range"==t.FilterMode&&this.renderColumnFilterControl(t.htmlName,t.gxControl.type,t.gxControl.dataType,t.filterLess,this.handleChangeFilterLess),"range"==t.FilterMode&&this.renderColumnFilterControl(t.htmlName,t.gxControl.type,t.gxControl.dataType,t.filterGreater,this.handleChangeFilterGreater)))}renderColumnFilterControl(t,s,i,n,r){switch(s){case h.EDIT:case h.CHECK:return e("label",null,e("input",{type:this.getFilterInputType(i),value:n,"data-column-id":t,onChange:r.bind(this)}))}}renderRows(){return this.grid.rows.map((t,s)=>e("ch-grid-row",{rowid:t.gxId,class:s%2==0?`${this.grid.RowClass} ${this.grid.RowEvenClass}`:`${this.grid.RowClass} ${this.grid.RowOddClass}`},this.renderCells(t)))}renderCells(t){return t.gxProps.map((t,s)=>{const i=this.grid.columns[s];if(gx.lang.gxBoolean(i.render))return e("ch-grid-cell",{class:this.grid.CellClass,cellid:s,innerHTML:this.renderControl(i.gxControl,t)})})}renderControl(t,e){return t.setProperties.apply(t,e),t.getHtml()}renderPaginator(){return e("ch-paginator",{class:this.grid.pagingBarClass,slot:"footer"},this.renderPaginatorNavigate(i.FIRST,this.grid.isFirstPage(),this.grid.pagingButtonFirstClass,gx.getMessage("GXM_first")),this.renderPaginatorNavigate(i.PREVIOUS,this.grid.isFirstPage(),this.grid.pagingButtonPreviousClass,gx.getMessage("GXM_previous")),this.renderPaginatorNavigate(i.NEXT,this.grid.isLastPage(),this.grid.pagingButtonNextClass,gx.getMessage("GXM_next")),this.renderPaginatorNavigate(i.LAST,this.grid.isLastPage(),this.grid.pagingButtonLastClass,gx.getMessage("GXM_last")))}renderPaginatorNavigate(t,s,i,n){const r=this.grid.PaginatorNavigationButtonTextPosition;return e("ch-paginator-navigate",{type:t,disabled:s,class:i,title:"title"==r?n:""},"text"==r?n:"")}getColumnSize(t){let e;switch(t.Size){case"auto":e="auto";break;case"css":e=`var(--${t.SizeVariableName}, min-content)`;break;case"length":e=t.SizeLength;break;case"max":e="max-content";break;case"min":e="min-content";break;case"minmax":e=`minmax(${t.SizeMinLength||"min-content"}, ${t.SizeMaxLength||"auto"})`;break;default:e="min-content"}return e||"min-content"}defineColumnRender(){const t=this.grid.properties;this.grid.columns.forEach((e,s)=>{e.render=0==t.length&&e.visible||t.some(t=>t[s].visible)})}getRowIndexByGxId(t){return this.grid.rows.findIndex(e=>e.gxId==t)}notifyResizePopup(){gx.popup.ispopup()&&gx.fx.obs.notify("gx.onafterevent")}setCurrentRow(){const t=this.grid.rows[0];t&&!gx.fn.currentGridRowImpl(this.grid.gxId)&&gx.fn.setCurrentGridRow(this.grid.gxId,t.gxId)}loadState(){r.load(this.grid,this.state)}getFilterInputType(t){switch(t){case l.BOOLEAN:return"checkbox";case l.CHAR:case l.VARCHAR:case l.LONGVARCHAR:return"text";case l.DATE:return"date";case l.DATETIME:return"datetime-local";case l.NUMBER:return"number";default:return"text"}}static get watchers(){return{state:["controlStateHandler"]}}};var h,l;!function(t){t[t.EDIT=1]="EDIT",t[t.RADIO=4]="RADIO",t[t.COMBO=5]="COMBO",t[t.CHECK=7]="CHECK"}(h||(h={})),function(t){t[t.NUMBER=0]="NUMBER",t[t.CHAR=1]="CHAR",t[t.DATE=2]="DATE",t[t.DATETIME=3]="DATETIME",t[t.VARCHAR=5]="VARCHAR",t[t.LONGVARCHAR=6]="LONGVARCHAR",t[t.BOOLEAN=7]="BOOLEAN"}(l||(l={})),a.style="gx-grid-chameleon{display:contents}";export{a as gx_grid_chameleon}